<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="mybatis.mapper.bbs">

	<select id="bbsSelectList" resultType="bbsDTO">
		select b.*,m.name
		from bbs b Join member m  ON b.id=m.id
		order by no desc
	</select>
	
	<insert id="bbsInsert" parameterType="Map">
		insert into bbs
		values(SEQ_BBS.NEXTVAL,#{id},#{title},#{content},default,#{lat},#{lng})
	</insert>
	
	<select id="bbsSelectOne" parameterType="Map"  resultType="bbsDTO">
		select b.*,m.name
		from bbs b JOIN member m ON b.id=m.id
		Where no=#{no}
	</select>
	
	<update id="bbsUpdate" parameterType="Map">
		update bbs
		set title=#{title}, content=#{content}
		Where no=#{no}
	</update>
	
	<delete id="bbsDelete" parameterType="Map">
		delete bbs
		where no = #{no} 
	</delete>
	
	<select id="bbsLikeCheck" parameterType="Map" resultType="Int">
		select count(*)
		from liketo
		where no=#{no} and id=#{id}
	</select>
	
	<insert id="bbsLike" parameterType="Map">
		insert into liketo
		values (#{id},#{no})
	</insert>
	
	<update id="bbsLikeCount" parameterType="Map">
		update bbs
		set likecount=(select count(*) from liketo where no=#{no})
		where no=#{no}
	</update>
	
	<delete id="bbsUnLike" parameterType="Map">
		delete liketo
		where no=#{no} and id=#{id}
	</delete>
	
	<insert id="stampInsert" parameterType="Map">
		insert into stamp(no,lat,lng,sno)
		select no,lat,lng,SEQ_STAMP.nextval
		from bbs
		where no=#{no}
	</insert>
</mapper>